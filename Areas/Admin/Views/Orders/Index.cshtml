@using WebApplication2.Models
@model IEnumerable<WebApplication2.Models.Order>
@{
    ViewData["Title"] = "Управління замовленнями";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1><i class="fas fa-shopping-cart"></i> Управління замовленнями</h1>
        <div>
            <button class="btn btn-outline-primary" onclick="window.print()">
                <i class="fas fa-print"></i> Друк
            </button>
        </div>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover" id="ordersTable">
                    <thead>
                        <tr>
                            <th>№ Замовлення</th>
                            <th>Клієнт</th>
                            <th>Email</th>
                            <th>Телефон</th>
                            <th>Сума</th>
                            <th>Статус</th>
                            <th>Дата</th>
                            <th>Дії</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var order in Model)
                        {
                            <tr>
                                <td><strong>@order.OrderNumber</strong></td>
                                <td>@order.CustomerName</td>
                                <td>@order.CustomerEmail</td>
                                <td>@order.CustomerPhone</td>
                                <td>@order.TotalAmount.ToString("N0") грн</td>
                                <td>
                                    <select class="form-select form-select-sm status-select" 
                                            data-order-id="@order.Id"
                                            style="width: 150px;">
                                        <option value="0" selected="@(order.Status == OrderStatus.New)">Нове</option>
                                        <option value="1" selected="@(order.Status == OrderStatus.Processing)">В обробці</option>
                                        <option value="2" selected="@(order.Status == OrderStatus.Shipped)">Відправлено</option>
                                        <option value="3" selected="@(order.Status == OrderStatus.Delivered)">Доставлено</option>
                                        <option value="4" selected="@(order.Status == OrderStatus.Cancelled)">Скасовано</option>
                                    </select>
                                </td>
                                <td>@order.CreatedAt.ToString("dd.MM.yyyy HH:mm")</td>
                                <td>
                                    <div class="btn-group">
                                        <a asp-action="Details" asp-route-id="@order.Id" 
                                           class="btn btn-sm btn-outline-primary" title="Деталі">
                                            <i class="fas fa-eye"></i>
                                        </a>
                                        <a asp-action="DownloadReceipt" asp-route-id="@order.Id" 
                                           class="btn btn-sm btn-outline-secondary" title="Завантажити чек">
                                            <i class="fas fa-download"></i>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            $('.status-select').on('change', function() {
                const orderId = $(this).data('order-id');
                const status = $(this).val();
                
                if (confirm('Змінити статус замовлення?')) {
                    $.post('/Admin/Orders/UpdateStatus', { orderId: orderId, status: status })
                        .done(function(response) {
                            if (response.success) {
                                showToast('Статус оновлено!', 'success');
                            } else {
                                showToast(response.message, 'danger');
                            }
                        })
                        .fail(function() {
                            showToast('Помилка з\'єднання', 'danger');
                        });
                }
            });
        });
    </script>
}